{
  "variables": {
    "aws_access_key": "$AWS_ACCESS_KEY_ID",
    "aws_secret_key": "$AWS_SECRET_ACCESS_KEY"
  },
  "builders": [
    {
      "type": "docker",
      "image": "nginx",
      "commit": "true"	    
     }
   ],
   
   "provisioners": [  	   
    {
      "type": "file",
      "source": "app/index.html",
      "destination": "/usr/share/nginx/html/index.html"
     }
  ],

   "post-processors": [
      [
	{
	  "type": "docker-tag",
	  "repository": "096961528614.dkr.ecr.us-east-1.amazonaws.com/packer-docker",		
	  "tag": "v1"
	},
	{
	  "type": "docker-tag",
	  "repository": "096961528614.dkr.ecr.us-east-1.amazonaws.com/096961528614.dkr.ecr.us-east-1.amazonaws.com/packer-docker",		
	  "tag": "v1"
	},
	{
	  "type": "shell-local",
	  "inline": "aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 096961528614.dkr.ecr.us-east-1.amazonaws.com"
	},	      
       {
        "type":"docker-push",      
        "login_server": "https://096961528614.dkr.ecr.us-east-1.amazonaws.com/test/"
      }   
    ]
  ]
}

